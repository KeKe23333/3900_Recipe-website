<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yyds.recipe.mapper.UserMapper">
    <insert id="saveUser" parameterType="com.yyds.recipe.model.User">
        insert into recipe.user(user_id, email, first_name, last_name, nick_name, birthdate, gender,
                                create_time)
        values (#{userId}, #{email}, #{firstName}, #{lastName}, #{nickName}, #{birthDate}, #{gender}, #{createTime});
    </insert>

    <insert id="saveUserAccount" parameterType="com.yyds.recipe.model.User">
        insert into recipe.user_account(user_id, password)
        values (#{userId}, #{password})
    </insert>

    <update id="editUser" parameterType="com.yyds.recipe.model.User">
        update recipe.user
        <set>
            <if test="firstName != null">
                firstName=#{firstName},
            </if>
            <if test="lastName != null">
                lastName=#{lastName},
            </if>
            <if test="nickName != null">
                nickName=#{nickName},
            </if>
            <if test="birthdate != null">
                birthDate=#{birthDate},
            </if>
            <if test="gender">
                gender=#{gender},
            </if>
            <if test="profilePhoto != null">
                profilePhoto=#{profilePhoto}
            </if>
        </set>
        <where>
            userId=#{userId}
        </where>
    </update>

    <select id="getLoginUserInfo" resultType="com.yyds.recipe.model.LoginUser" parameterType="java.lang.String">
        select ua.user_id, ua.password, u.email
        from recipe.user_account ua
                 inner join recipe.user u
        on ua.user_id = u.user_id where u.email = #{email}
    </select>

</mapper>